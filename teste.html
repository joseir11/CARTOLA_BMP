<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TAÇA NATTOS 2026</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=Teko:wght@600;700&display=swap" rel="stylesheet">

<style>
:root {
  --green: #22c55e;
  --red: #ef4444;
  --orange: #f59e0b;
  --bg: #111827;
  --topo-grad: rgba(17, 24, 39, 0.8);
  --text-light: #e5e7eb;
}

/* FONTE */
@font-face {
  font-family: 'Fontecartola';
  src: url('Fontecartola.otf') format('opentype');
  font-weight: normal;
  font-style: normal;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  color: #fff;
  -webkit-tap-highlight-color: transparent;
  overflow-x: hidden;
}

/* CABEÇALHO */
.header {
  display: flex;
  flex-direction: column;
  padding: 15px;
  background: var(--topo-grad);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  gap: 12px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  position: sticky;
  top: 0;
  z-index: 1000;
}

.header-topo-mobile { 
  display: flex; 
  align-items: center; 
  justify-content: center;
  gap: 15px;
  position: relative;
}

.titulo-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
}

.titulo-principal { 
  font-family: 'Teko', sans-serif;
  font-size: 50px; 
  font-weight: 700; 
  color: var(--orange); 
  line-height: 0.9;
  text-transform: uppercase;
  text-shadow: 0 0 15px rgba(245, 158, 11, 0.5);
}

.ano-titulo {
  font-family: 'Teko', sans-serif;
  font-size: 18px;
  color: #ffffff;
  align-self: flex-end;
  margin-top: -5px;
}

.header-controles-mobile { 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  gap: 10px;
}

/* CONTAINER BOLA - LOGO */
.container-logo-bola {
  width: 62px;
  height: 62px;
  background: rgba(245, 158, 11, 0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 15px rgba(245, 158, 11, 0.15);
  flex-shrink: 0;
}

/* LOGO CARTOLA.png */
.logo-campeonato { 
  height: 55px; 
  width: auto; 
  filter: drop-shadow(0 0 5px rgba(255,255,255,0.2));
}

/* TOGGLE DE VISUALIZAÇÃO */
.toggle-visual { 
  width: 90px; 
  background: rgba(255,255,255,0.08); 
  border-radius: 999px; 
  padding: 4px; 
  display: flex; 
  justify-content: space-between;
  border: 1px solid rgba(255,255,255,0.05);
}

.toggle-btn { 
  width: 36px;
  height: 36px; 
  border-radius: 50%; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  cursor: pointer; 
  border: none; 
  background: transparent; 
  color: #9ca3af; 
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.toggle-btn.ativo { 
  background: var(--orange); 
  color: #000; 
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

.icon-vertical { transform: rotate(90deg); }

/* BADGE RDD */
.badge-rdd { 
  display: flex; 
  align-items: center;
  justify-content: flex-start;
  gap: 10px; 
  background: rgba(255,255,255,0.08); 
  padding: 4px 18px 4px 4px;
  border-radius: 999px; 
  height: 44px;
  border: 1px solid rgba(255,255,255,0.05);
  min-width: 110px;
  position: relative;
  cursor: pointer;
}
.bola-rdd { 
  width: 36px; 
  height: 36px; 
  border-radius: 50%; 
  background: var(--orange); 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  font-weight: 900; 
  color: #000; 
  font-size: 11px;
  flex-shrink: 0;
}
.texto-rdd { 
  font-family: 'Fontecartola', 'Inter', sans-serif; 
  font-weight: 800; 
  font-size: 22px;
  color: var(--text-light); 
  line-height: 1;
  letter-spacing: 0.5px;
}

/* BLOCO SÉRIES */
.bloco-series {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  margin: 10px 0 10px 0;
}

.titulo-serie {
  font-family: 'Fontecartola', 'Inter', sans-serif;
  font-weight: 800;
  font-size: 22px;
  color: var(--text-light);
  line-height: 1;
  letter-spacing: 0.5px;
}

.seletor-series-badge {
  display: flex;
  align-items: center;
  background: rgba(255,255,255,0.08);
  padding: 4px;
  border-radius: 999px;
  height: 44px;
  border: 1px solid rgba(255,255,255,0.05);
}

.btn-serie {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-family: 'Fontecartola', 'Inter', sans-serif;
  font-weight: 900;
  font-size: 22px;
  color: #9ca3af;
  background: transparent;
  border: none;
  transition: all 0.3s ease;
}

.btn-serie.ativo {
  background: var(--orange);
  color: #000;
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

/* BOTÃO VOLTAR */
.btn-voltar-container {
  display: none;
  align-items: center;
  justify-content: center;
  margin: 10px 0;
}

.btn-voltar {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  background: rgba(255,255,255,0.08);
  padding: 8px 20px;
  border-radius: 999px;
  height: 44px;
  border: 1px solid rgba(255,255,255,0.05);
  cursor: pointer;
  font-family: 'Fontecartola', 'Inter', sans-serif;
  font-weight: 800;
  font-size: 18px;
  color: var(--text-light);
  transition: all 0.3s ease;
}

.btn-voltar:hover {
  background: rgba(245, 158, 11, 0.2);
}

.btn-voltar svg {
  width: 20px;
  height: 20px;
  stroke: var(--orange);
}

/* TIME DESTAQUE */
.time-destaque-container {
  display: none;
  align-items: center;
  justify-content: flex-end;
  margin: 10px 20px;
  font-family: 'Fontecartola', 'Inter', sans-serif;
  font-size: 24px;
  font-weight: 800;
  color: var(--orange);
  text-transform: uppercase;
  text-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
}

/* ANIMAÇÃO */
#displayA, #displayB {
  animation: fadeIn 0.6s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* CAMPO */
.campo {
  position: relative;
  margin: 0 auto;
  width: 95%;
  max-width: 520px;
  aspect-ratio: 9/14;
  border-radius: 24px;
  overflow: visible;
  background: #0f172a url("./campo.png") center/cover no-repeat;
  border: 2px solid rgba(34,197,94,0.15);
  box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}

/* CAMPO LIMPO (quando vazio) */
.campo-limpo {
  position: relative;
  margin: 0 auto;
  width: 95%;
  max-width: 520px;
  aspect-ratio: 9/14;
  border-radius: 24px;
  overflow: visible;
  background: #0f172a url("./campo.png") center/cover no-repeat;
  border: 2px solid rgba(34,197,94,0.15);
  box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}

/* CARDS DE JOGADORES NA ESCALAÇÃO */
.jogador-card {
  position: absolute;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  z-index: 10;
  width: 80px;
}

.logo-clube-escalacao {
  height: 48px;
  width: auto;
  object-fit: contain;
  filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
}

.nome-jogador {
  font-family: 'Inter', sans-serif;
  font-weight: 600;
  font-size: 9px;
  color: #fff;
  background: rgba(0,0,0,0.6);
  padding: 2px 6px;
  border-radius: 10px;
  margin-top: 2px;
  text-align: center;
  white-space: nowrap;
  max-width: 80px;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* NOVO ESTILO PARA O VALOR - IGUAL AO BADGE DA TELA INICIAL */
.valor-jogador {
  font-family: 'Teko', sans-serif;
  font-weight: 700;
  font-size: 16px;
  position: absolute;
  top: 15px;
  right: -15px;
  color: white;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
  z-index: 15;
}

.valor-jogador.negativo {
  color: var(--red);
}

/* CARDS DE TIMES */
.card-time {
  position: absolute;
  width: 100px;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  z-index: 10;
}

.logo-campo { 
  width: 78px; 
  height: 78px; 
  object-fit: contain; 
  filter: drop-shadow(0 8px 12px rgba(0,0,0,0.7));
  cursor: pointer;
  transition: transform 0.2s ease;
}

.logo-campo:hover {
  transform: scale(1.05);
}

.logo-campo:active {
  transform: scale(0.95);
}

.badge-pontos-campo {
  background: var(--orange);
  color: #000;
  font-weight: 900;
  font-size: 13px;
  padding: 3px 10px;
  border-radius: 20px;
  margin-top: 2px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  transition: transform 0.2s;
}
.badge-pontos-campo:active { transform: scale(0.9); }

.badge-lider { background: var(--green) !important; color: white !important; }
.badge-rebaixamento { background: var(--red) !important; color: white !important; }

.posicao-campo {
  position: absolute;
  top: 40px; 
  right: -5px; 
  font-family: 'Teko'; 
  font-size: 40px; 
  text-shadow: 2px 2px 4px #000;
  z-index: 20;
}

.trofeu-campo {
  position: absolute;
  width: 50px;
  transform: translate(-50%, -50%);
  z-index: 5;
  pointer-events: none;
  filter: drop-shadow(0 4px 15px rgba(245,158,11,0.4));
}

.garcom {
  position: absolute;
  height: 128px;
  width: auto;
  transform: translate(-180%, -45%);
  filter: drop-shadow(0 4px 12px rgba(0,0,0,0.6));
  z-index: 5;
  pointer-events: none;
}

.pop-detalhes {
  position: absolute;
  bottom: 120%;
  left: 50%;
  transform: translateX(-50%);
  background: #1e293b;
  color: #f1f5f9;
  padding: 12px;
  border-radius: 12px;
  width: 170px;
  font-size: 11px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
  z-index: 999;
  display: none;
  border: 1px solid rgba(255,255,255,0.1);
}
.pop-detalhes b { color: var(--orange); display: block; border-bottom: 1px solid #334155; margin-bottom: 6px; font-size: 12px; text-align: center; text-transform: uppercase; font-family: 'Fontecartola', 'Inter', sans-serif; }
.pop-grid-header { display: grid; grid-template-columns: 25px 1fr 1fr 1fr; font-weight: 800; color: #94a3b8; border-bottom: 1px solid #334155; padding-bottom: 4px; margin-bottom: 4px; text-align: center; }
.pop-grid-row { display: grid; grid-template-columns: 25px 1fr 1fr 1fr; text-align: center; padding: 4px 0; border-bottom: 1px solid #334155; }

/* TABELA LISTA */
.lista-container { 
  width: 95%; 
  max-width: 600px; 
  margin: 0 auto; 
  background: #1e293b; 
  border-radius: 16px; 
  overflow: hidden; 
  color: #fff;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  border: 1px solid rgba(255,255,255,0.05);
}
.tabela-times { width: 100%; border-collapse: collapse; }
.tabela-times td { padding: 14px 10px; vertical-align: middle; border-bottom: 1px solid rgba(255,255,255,0.05); }
.tabela-times tr:nth-child(even) { background: rgba(255,255,255,0.02); }

.td-posicao { font-family: 'Teko'; font-size: 24px; font-weight: 700; color: #64748b; text-align: center; width: 50px; }
.td-escudo img { width: 44px; height: 44px; object-fit: contain; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); cursor: pointer; }
.td-nome { font-family: 'Fontecartola', 'Inter', sans-serif; font-weight: 800; font-size: 20px; text-transform: uppercase; color: #f1f5f9; letter-spacing: 0.5px; }
.td-pontos { text-align: right; padding-right: 20px !important; }
.pontuacao-total { font-weight: 900; font-size: 18px; display: block; color: var(--orange); }
.detalhes-lista { font-size: 10px; color: #94a3b8; font-weight: 600; text-transform: uppercase; }

.status-lider .td-nome { color: var(--green) !important; }
.status-rebaixamento .td-nome { color: var(--red) !important; }
</style>
</head>
<body onclick="fecharTodosCards()">

<div class="header">
  <div class="header-topo-mobile">
    <div class="container-logo-bola">
      <img src="./CARTOLA.png" class="logo-campeonato">
    </div>
    <div class="titulo-wrapper">
      <div class="titulo-principal">TAÇA NATTOS</div>
      <div class="ano-titulo">2026</div>
    </div>
  </div>
  <div class="header-controles-mobile">
    <div class="toggle-visual">
      <button class="toggle-btn ativo" id="btnCampo" onclick="mudarVisual('campo')">
        <svg class="icon-vertical" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="2" y="5" width="20" height="14" rx="2"></rect><line x1="12" y1="5" x2="12" y2="19"></line><circle cx="12" cy="12" r="2.5"></circle></svg>
      </button>
      <button class="toggle-btn" id="btnLista" onclick="mudarVisual('lista')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="4" y="3" width="16" height="18" rx="2"></rect><rect x="9" y="1" width="6" height="4" rx="1"></rect><line x1="8" y1="10" x2="16" y2="10"></line><line x1="8" y1="14" x2="16" y2="14"></line></svg>
      </button>
    </div>
    
    <div class="badge-rdd">
      <div class="bola-rdd">RDD</div>
      <div id="info-rdd-topo" class="texto-rdd">-- / 19</div>
      <select id="seletor-rodada" onchange="alterarRodadaManual(this.value)" style="position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%;"></select>
    </div>
  </div>
</div>

<!-- Botão voltar -->
<div class="btn-voltar-container" id="btnVoltarContainer">
  <div class="btn-voltar" onclick="voltarParaCampo()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    VOLTAR AO CAMPO
  </div>
</div>

<!-- Nome do time em destaque -->
<div class="time-destaque-container" id="timeDestaque"></div>

<div class="bloco-series">
  <div class="titulo-serie">SÉRIES</div>
  <div class="seletor-series-badge">
    <div class="btn-serie ativo" data-serie="A" onclick="selecionarSerie('A')">A</div>
    <div class="btn-serie" data-serie="B" onclick="selecionarSerie('B')">B</div>
  </div>
</div>

<div id="containerA">
  <div id="displayA"></div>
</div>

<div id="containerB" style="display:none">
  <div id="displayB"></div>
</div>

<script src="tabela.js"></script>
<script src="escalacoes.js"></script>
<script>
/* POSIÇÕES POR FORMAÇÃO - AGORA COM A PROPRIEDADE "pos" */
const posicoesPorFormacao = {
  "343": [
    { t: 23, l: 50, pos: "ATA" },
    { t: 25, l: 20, pos: "ATA" },
    { t: 25, l: 80, pos: "ATA" },
    { t: 42, l: 50, pos: "MEI" },
    { t: 42, l: 15, pos: "MEI" },
    { t: 44, l: 50, pos: "MEI" },
    { t: 44, l: 85, pos: "MEI" },
    { t: 67, l: 15, pos: "ZAG" },
    { t: 65, l: 50, pos: "ZAG" },
    { t: 67, l: 85, pos: "ZAG" },
    { t: 85, l: 50, pos: "GOL" },
    { t: 85, l: 15, pos: "TEC" }
  ],
  "352": [
    { t: 23, l: 30, pos: "ATA" },
    { t: 23, l: 70, pos: "ATA" },
    { t: 42, l: 50, pos: "MEI" },
    { t: 44, l: 15, pos: "MEI" },
    { t: 44, l: 85, pos: "MEI" },
    { t: 50, l: 30, pos: "MEI" },
    { t: 50, l: 70, pos: "MEI" },
    { t: 65, l: 15, pos: "ZAG" },
    { t: 67, l: 50, pos: "ZAG" },
    { t: 65, l: 85, pos: "ZAG" },
    { t: 85, l: 50, pos: "GOL" },
    { t: 85, l: 15, pos: "TEC" }
  ],
  "433": [
    { t: 23, l: 50, pos: "ATA" },
    { t: 25, l: 20, pos: "ATA" },
    { t: 25, l: 80, pos: "ATA" },
    { t: 42, l: 50, pos: "MEI" },
    { t: 44, l: 15, pos: "MEI" },
    { t: 44, l: 85, pos: "MEI" },
    { t: 67, l: 15, pos: "LAT" },
    { t: 65, l: 38, pos: "ZAG" },
    { t: 65, l: 62, pos: "ZAG" },
    { t: 67, l: 85, pos: "LAT" },
    { t: 85, l: 50, pos: "GOL" },
    { t: 85, l: 15, pos: "TEC" }
  ],
  "442": [
    { t: 23, l: 30, pos: "ATA" },
    { t: 23, l: 70, pos: "ATA" },
    { t: 44, l: 15, pos: "MEI" },
    { t: 42, l: 38, pos: "MEI" },
    { t: 42, l: 62, pos: "MEI" },
    { t: 44, l: 85, pos: "MEI" },
    { t: 67, l: 15, pos: "LAT" },
    { t: 65, l: 38, pos: "ZAG" },
    { t: 65, l: 62, pos: "ZAG" },
    { t: 67, l: 85, pos: "LAT" },
    { t: 85, l: 50, pos: "GOL" },
    { t: 85, l: 15, pos: "TEC" }
  ],
  "532": [
    { t: 23, l: 30, pos: "ATA" },
    { t: 23, l: 70, pos: "ATA" },
    { t: 44, l: 15, pos: "MEI" },
    { t: 42, l: 50, pos: "MEI" },
    { t: 42, l: 85, pos: "MEI" },
    { t: 67, l: 15, pos: "LAT" },
    { t: 65, l: 30, pos: "ZAG" },
    { t: 65, l: 45, pos: "ZAG" },
    { t: 65, l: 60, pos: "ZAG" },
    { t: 67, l: 85, pos: "LAT" },
    { t: 85, l: 50, pos: "GOL" },
    { t: 85, l: 15, pos: "TEC" }
  ]
};

/* POSIÇÕES PADRÃO PARA O CAMPO NORMAL */
const posCampo = [
    { t: 23, l: 50 },
    { t: 25, l: 20 },
    { t: 25, l: 80 },
    { t: 42, l: 50 },
    { t: 44, l: 15 },
    { t: 44, l: 85 },
    { t: 65, l: 15 },
    { t: 67, l: 50 },
    { t: 65, l: 85 },
    { t: 85, l: 50 }
];

const posTrofeu = { t: 10, l: 51 };

let modoAtivo = 'campo';
let serieAtiva = 'A';
let rodadaSelecionada = 0;
let rodadaMaximaGlobal = 0;
let dadosSerieA = [];
let dadosSerieB = [];
let visualizandoTime = false;
let timeSelecionado = null;

function processarDados(historicoBruto, rodadaAlvo) {
    const agrupado = {};
    let maxNoArquivo = 0;
    
    historicoBruto.forEach(item => { if(item.rdd > maxNoArquivo) maxNoArquivo = item.rdd; });
    if(maxNoArquivo > rodadaMaximaGlobal) rodadaMaximaGlobal = maxNoArquivo;

    const rddLimite = rodadaAlvo || maxNoArquivo;

    historicoBruto.forEach(item => {
        if (item.rdd <= rddLimite) {
            if (!agrupado[item.nome]) {
                agrupado[item.nome] = { 
                    nome: item.nome, 
                    total: 0, 
                    somaRDD: 0, 
                    somaRE: 0, 
                    somaPEN: 0, 
                    ultimaRDDVal: 0,
                    rodadas: [] 
                };
            }
            agrupado[item.nome].somaRDD += item.val;
            agrupado[item.nome].somaRE += item.re;
            agrupado[item.nome].somaPEN += item.pen;
            agrupado[item.nome].rodadas.push(item);
        }
    });

    const listaFinal = Object.values(agrupado).map(time => {
        time.total = (time.somaRDD + time.somaRE) - time.somaPEN;
        const rddsFiltradas = time.rodadas.filter(r => r.rdd <= rddLimite);
        const ultimaRodadaObj = rddsFiltradas.reduce((prev, current) => (prev.rdd > current.rdd) ? prev : current, {val: 0});
        time.ultimaRDDVal = ultimaRodadaObj.val;
        time.rodadas.sort((a, b) => b.rdd - a.rdd);
        return time;
    });

    listaFinal.sort((a, b) => b.total - a.total);
    return { ranking: listaFinal, rdd: rddLimite };
}

function atualizarSeletorRodadas() {
    const seletor = document.getElementById('seletor-rodada');
    seletor.innerHTML = '';
    for (let i = 1; i <= rodadaMaximaGlobal; i++) {
        const opt = document.createElement('option');
        opt.value = i;
        opt.innerText = `Rodada ${i.toString().padStart(2, '0')}`;
        if (i === rodadaSelecionada) opt.selected = true;
        seletor.appendChild(opt);
    }
}

function alterarRodadaManual(rdd) {
    rodadaSelecionada = parseInt(rdd);
    // Atualiza o texto do badge
    document.getElementById('info-rdd-topo').innerText = `${rodadaSelecionada.toString().padStart(2, '0')} / 19`;
    
    if (visualizandoTime && timeSelecionado) {
        // Se estiver visualizando um time, recarrega a escalação com a nova rodada
        mostrarTime(timeSelecionado);
    } else {
        // Senão, atualiza a tela normal do campeonato
        atualizarTelas();
    }
}

// Função para buscar escalação no bancoEscalacoes (estrutura: array misturado)
function buscarEscalacao(timeNome, rodada) {
    if (typeof bancoEscalacoes === 'undefined' || !bancoEscalacoes[timeNome]) {
        console.log('Time não encontrado no bancoEscalacoes:', timeNome);
        return null;
    }
    const dados = bancoEscalacoes[timeNome]; // array
    let i = 0;
    while (i < dados.length) {
        if (dados[i].rdd !== undefined && dados[i].rdd === rodada) {
            const formacao = dados[i].formacao;
            const jogadores = [];
            i++; // pula o objeto da rodada
            // Coleta todos os jogadores até o próximo objeto com rdd ou fim
            while (i < dados.length && dados[i].rdd === undefined) {
                jogadores.push(dados[i]);
                i++;
            }
            return { formacao, jogadores };
        }
        i++;
    }
    console.log('Rodada', rodada, 'não encontrada para o time', timeNome);
    return null;
}

// Função para mostrar escalação do time
function mostrarTime(timeNome) {
    visualizandoTime = true;
    timeSelecionado = timeNome;
    
    // Esconde o bloco de séries
    document.querySelector('.bloco-series').style.display = 'none';
    
    // Mostra o botão voltar e o nome do time
    document.getElementById('btnVoltarContainer').style.display = 'flex';
    document.getElementById('timeDestaque').style.display = 'flex';
    document.getElementById('timeDestaque').innerHTML = timeNome.replace(/_/g, ' ');
    
    // Limpa os displays
    document.getElementById('displayA').innerHTML = '';
    document.getElementById('displayB').innerHTML = '';
    
    const escalacao = buscarEscalacao(timeNome, rodadaSelecionada);
    if (escalacao) {
        renderEscalacao(escalacao.formacao, escalacao.jogadores);
    } else {
        renderCampoLimpo();
    }
}

// Função para renderizar a escalação no campo, respeitando as posições
function renderEscalacao(formacao, jogadores) {
    const posicoes = posicoesPorFormacao[formacao.toString()];
    if (!posicoes) {
        console.log('Formação não encontrada:', formacao);
        renderCampoLimpo();
        return;
    }
    
    const container = document.getElementById('displayA');
    container.innerHTML = '';
    
    const campoDiv = document.createElement('div');
    campoDiv.className = 'campo';
    
    // Filtra apenas titulares
    const titulares = jogadores.filter(j => j.status === "T");
    
    // Agrupa titulares por posição
    const jogadoresPorPosicao = {
        "GOL": [],
        "ZAG": [],
        "LAT": [],
        "MEI": [],
        "ATA": [],
        "TEC": []
    };
    
    titulares.forEach(j => {
        if (jogadoresPorPosicao.hasOwnProperty(j.pos)) {
            jogadoresPorPosicao[j.pos].push(j);
        } else {
            console.log('Posição desconhecida:', j.pos);
        }
    });
    
    // Itera sobre as posições do campo e coloca os jogadores na ordem
    posicoes.forEach(posObj => {
        const posicao = posObj.pos;
        const jogadoresDaPosicao = jogadoresPorPosicao[posicao];
        if (jogadoresDaPosicao && jogadoresDaPosicao.length > 0) {
            // Pega o primeiro jogador da fila e remove
            const jogador = jogadoresDaPosicao.shift();
            const valClass = jogador.val < 0 ? 'negativo' : '';
            
            campoDiv.innerHTML += `
                <div class="jogador-card" style="top:${posObj.t}%; left:${posObj.l}%">
                    <img class="logo-clube-escalacao" src="./TIMES/${jogador.clube}.png" alt="${jogador.clube}" onerror="this.src='./TIMES/default.png'">
                    <div class="nome-jogador">${jogador.nome}</div>
                    <div class="valor-jogador ${valClass}">${jogador.val.toFixed(2)}</div>
                </div>
            `;
        }
    });
    
    container.appendChild(campoDiv);
}

// Função para renderizar apenas o campo vazio (fallback)
function renderCampoLimpo() {
    document.getElementById('displayA').innerHTML = '';
    document.getElementById('displayB').innerHTML = '';
    
    const container = document.getElementById('displayA');
    const campoVazio = document.createElement('div');
    campoVazio.className = 'campo-limpo';
    container.appendChild(campoVazio);
}

// Função para voltar à visualização do campeonato
function voltarParaCampo() {
    visualizandoTime = false;
    timeSelecionado = null;
    
    document.querySelector('.bloco-series').style.display = 'flex';
    document.getElementById('btnVoltarContainer').style.display = 'none';
    document.getElementById('timeDestaque').style.display = 'none';
    
    atualizarTelas();
}

function atualizarTelas() {
    const resA = processarDados(typeof historicoSerieA !== 'undefined' ? historicoSerieA : [], rodadaSelecionada);
    const resB = processarDados(typeof historicoSerieB !== 'undefined' ? historicoSerieB : [], rodadaSelecionada);
    
    dadosSerieA = resA.ranking;
    dadosSerieB = resB.ranking;

    document.getElementById('info-rdd-topo').innerText = `${rodadaSelecionada.toString().padStart(2, '0')} / 19`;
    
    renderSeção("displayA", dadosSerieA, true);
    renderSeção("displayB", dadosSerieB, false);
}

function fecharTodosCards() {
  document.querySelectorAll('.pop-detalhes').forEach(c => c.style.display = 'none');
}

function alternarCard(e, id) {
  e.stopPropagation();
  fecharTodosCards();
  document.querySelectorAll('.card-time').forEach(el => el.style.zIndex = "10");
  const card = document.getElementById('pop-' + id);
  if(card) { card.style.display = 'block'; card.parentElement.style.zIndex = "1000"; }
}

function renderSeção(id, data, isA) {
  const container = document.getElementById(id);
  container.innerHTML = "";
  
  if(visualizandoTime) {
    return;
  }
  
  if(modoAtivo === 'campo') {
    const campoDiv = document.createElement("div");
    campoDiv.className = "campo";
    campoDiv.innerHTML += `<img src="./TROFEU_NATTOS.png" class="trofeu-campo" style="top:${posTrofeu.t}%; left:${posTrofeu.l}%">`;
    data.forEach((time, i) => {
      const p = posCampo[i];
      if(!p) return;
      const idUnico = id + i;
      let bClass = (isA && i >= 8) ? "badge-rebaixamento" : (!isA && i <= 1) ? "badge-lider" : "";
      // Adiciona a imagem do garçom para o último colocado
      if(i === 9) campoDiv.innerHTML += `<img class="garcom" src="./GARCONS/${time.nome}.png" style="top:${p.t}%; left:${p.l}%" onerror="this.style.display='none'">`;
      const linhasHistorico = time.rodadas.map(r => `
          <div class="pop-grid-row">
            <span>${r.rdd}</span>
            <span style="color:#60a5fa">${r.val.toFixed(2)}</span>
            <span style="color:#4ade80">${r.re.toFixed(2)}</span>
            <span style="color:#f87171">${r.pen.toFixed(2)}</span>
          </div>
      `).join('');
      campoDiv.innerHTML += `
        <div class="card-time" style="top:${p.t}%; left:${p.l}%">
          <div class="pop-detalhes" id="pop-${idUnico}">
             <b>${time.nome.replace(/_/g, ' ')}</b>
             <div class="pop-grid-header">
                <span>RD</span><span>VAL</span><span>RE</span><span>PEN</span>
             </div>
             ${linhasHistorico}
          </div>
          <div class="posicao-campo">${i+1}</div>
          <img class="logo-campo" src="./ESCUDOS/${time.nome}.png" onclick="mostrarTime('${time.nome}')">
          <div class="badge-pontos-campo ${bClass}" onclick="alternarCard(event, '${idUnico}')">
            ${time.total.toFixed(2)}
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
          </div>
        </div>`;
    });
    container.appendChild(campoDiv);
  } else {
    let tabela = `<div class="lista-container"><table class="tabela-times">`;
    data.forEach((time, i) => {
      let rClass = (isA && i >= 8) ? "status-rebaixamento" : (!isA && i <= 1) ? "status-lider" : "";
      let iconePos = i === 0 ? `<img src="./TROFEU_NATTOS.png" style="width:20px; vertical-align:middle;">` : i+1;
      tabela += `<tr class="${rClass}">
        <td class="td-posicao">${iconePos}</td>
        <td class="td-escudo"><img src="./ESCUDOS/${time.nome}.png" onclick="mostrarTime('${time.nome}')" style="cursor:pointer"></td>
        <td class="td-nome">${time.nome.replace(/_/g, ' ')}</td>
        <td class="td-pontos">
          <span class="pontuacao-total">${time.total.toFixed(2)}</span>
          <span class="detalhes-lista">ULT. RDD: ${time.ultimaRDDVal.toFixed(2)} | RE: ${time.somaRE.toFixed(2)} | PEN: ${time.somaPEN.toFixed(2)}</span>
        </td></tr>`;
    });
    container.innerHTML = tabela + `</table></div>`;
  }
}

function mudarVisual(tipo) {
  modoAtivo = tipo;
  document.getElementById('btnCampo').classList.toggle('ativo', tipo === 'campo');
  document.getElementById('btnLista').classList.toggle('ativo', tipo === 'lista');
  if (!visualizandoTime) {
    atualizarTelas();
  }
}

function selecionarSerie(serie) {
  serieAtiva = serie;
  document.querySelectorAll('.btn-serie').forEach(b => b.classList.toggle('ativo', b.dataset.serie === serie));
  document.getElementById('containerA').style.display = serie === 'A' ? 'block' : 'none';
  document.getElementById('containerB').style.display = serie === 'B' ? 'block' : 'none';
}

(function init() {
    const resA = processarDados(typeof historicoSerieA !== 'undefined' ? historicoSerieA : []);
    rodadaSelecionada = resA.rdd;
    atualizarSeletorRodadas();
    selecionarSerie('A');
    mudarVisual('campo');
})();
</script>
<div style="height: 60px;"></div>

</body>
</html>
